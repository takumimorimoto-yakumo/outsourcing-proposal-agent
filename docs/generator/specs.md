# 提案文生成仕様

**最終更新**: 2025-12-12
**バージョン**: 1.0

---

## 目次

1. [概要](#1-概要)
2. [提案文の構成](#2-提案文の構成)
3. [生成パラメータ](#3-生成パラメータ)
4. [文字数制限](#4-文字数制限)
5. [カテゴリ別テンプレート](#5-カテゴリ別テンプレート)
6. [品質担保](#6-品質担保)
7. [データフロー](#7-データフロー)

---

## 1. 概要

### 1.1. 目的

案件情報、GitHub情報、固定文を組み合わせて、案件に最適化された提案文を生成する。

### 1.2. 使用AI

| 項目 | 値 |
|------|-----|
| AI | Gemini API |
| モデル | gemini-pro |
| 用途 | 提案文の動的部分の生成 |

### 1.3. 生成対象

| セクション | 生成方法 |
|-----------|---------|
| 挨拶・自己紹介 | 固定文（YAML） |
| 案件への理解・共感 | **AI生成** |
| 提案内容・アプローチ | **AI生成** |
| 技術力・実績 | **AI生成**（GitHub情報使用） |
| スケジュール・見積もり | **AI生成** |
| 締めの挨拶 | 固定文（YAML） |

---

## 2. 提案文の構成

### 2.1. 6パート構成

```
┌────────────────────────────────────────────────────────┐
│ Part 1: 挨拶・自己紹介 [固定文]                         │
│ - 挨拶                                                 │
│ - 自己紹介（経歴、専門分野）                            │
├────────────────────────────────────────────────────────┤
│ Part 2: 案件への理解・共感 [AI生成]                     │
│ - 案件の要点を自分の言葉で要約                          │
│ - クライアントの課題への共感                            │
├────────────────────────────────────────────────────────┤
│ Part 3: 提案内容・アプローチ [AI生成]                   │
│ - 具体的な実装方針                                      │
│ - 使用技術の選定理由                                    │
│ - 工夫点・差別化ポイント                                │
├────────────────────────────────────────────────────────┤
│ Part 4: 技術力・実績 [AI生成 + GitHub情報]              │
│ - 関連する技術経験                                      │
│ - 類似案件の実績（GitHubリポジトリ）                    │
│ - 具体的な成果物の紹介                                  │
├────────────────────────────────────────────────────────┤
│ Part 5: スケジュール・見積もり [AI生成]                 │
│ - 対応可能時期                                          │
│ - 想定スケジュール                                      │
│ - 稼働時間                                             │
├────────────────────────────────────────────────────────┤
│ Part 6: 締めの挨拶 [固定文]                             │
│ - 質問への対応                                          │
│ - 連絡先                                               │
│ - 締めの言葉                                           │
└────────────────────────────────────────────────────────┘
```

### 2.2. 各パートの目安文字数

| パート | 目安文字数 | 割合 |
|--------|-----------|------|
| 1. 挨拶・自己紹介 | 150-200字 | 10% |
| 2. 案件への理解 | 200-300字 | 15% |
| 3. 提案内容 | 400-600字 | 30% |
| 4. 技術力・実績 | 300-400字 | 20% |
| 5. スケジュール | 150-200字 | 10% |
| 6. 締めの挨拶 | 100-150字 | 8% |
| **合計** | **1,300-1,850字** | **100%** |

---

## 3. 生成パラメータ

### 3.1. Gemini API設定

```python
generation_config = {
    "temperature": 0.7,      # 創造性（0.0-1.0）
    "top_p": 0.9,            # 核サンプリング
    "top_k": 40,             # Top-K サンプリング
    "max_output_tokens": 2048,
}
```

### 3.2. パラメータの意図

| パラメータ | 値 | 意図 |
|-----------|-----|------|
| `temperature` | 0.7 | 自然で多様な文章を生成、ただし過度に創造的にならない |
| `top_p` | 0.9 | 確率の高いトークンを優先、安定した出力 |
| `max_output_tokens` | 2048 | 十分な長さの提案文を生成 |

### 3.3. 安全性設定

```python
safety_settings = [
    {"category": "HARM_CATEGORY_HARASSMENT", "threshold": "BLOCK_MEDIUM_AND_ABOVE"},
    {"category": "HARM_CATEGORY_HATE_SPEECH", "threshold": "BLOCK_MEDIUM_AND_ABOVE"},
]
```

---

## 4. 文字数制限

### 4.1. サービス別制限

| サービス | 提案文字数上限 | 目標文字数 |
|----------|---------------|-----------|
| ランサーズ | 2,000文字 | 1,500-1,800文字 |
| クラウドワークス | 2,000文字 | 1,500-1,800文字 |

### 4.2. 文字数調整ロジック

```python
def adjust_length(text: str, max_length: int = 2000) -> str:
    """文字数を制限内に調整"""
    if len(text) <= max_length:
        return text

    # 優先度の低いセクションから削減
    # 1. 実績の詳細説明を短縮
    # 2. 提案内容の詳細を短縮
    # 3. 最後に全体を切り詰め
    ...
```

### 4.3. 文字数カウント

| カウント対象 | 含む | 含まない |
|-------------|------|---------|
| 全角文字 | 1文字 | - |
| 半角英数字 | 1文字 | - |
| 改行 | 1文字 | - |
| 空白 | 1文字 | - |

---

## 5. カテゴリ別テンプレート

### 5.1. カテゴリと追加プロンプト

| カテゴリ | 追加で強調するポイント |
|---------|---------------------|
| `web_development` | レスポンシブ対応、SEO、パフォーマンス最適化 |
| `app_development` | ユーザビリティ、プラットフォーム対応、ストア申請経験 |
| `scraping` | データ品質、エラーハンドリング、メンテナンス性 |
| `automation` | 効率化の定量効果、保守性、拡張性 |
| `data_analysis` | 分析精度、可視化、ビジネスインサイト |
| `ai_ml` | モデル選定、精度、運用考慮 |

### 5.2. カテゴリ別の実績強調ポイント

```yaml
category_emphasis:
  web_development:
    - "レスポンシブデザインの実装経験"
    - "Core Web Vitals最適化の実績"
    - "アクセシビリティへの配慮"

  scraping:
    - "大規模データ収集の実績"
    - "アンチスクレイピング対策の経験"
    - "データクレンジング・正規化のノウハウ"

  automation:
    - "工数削減の定量的な実績"
    - "エラー処理・リカバリーの考慮"
    - "ドキュメント整備・引き継ぎ体制"
```

---

## 6. 品質担保

### 6.1. 品質チェック項目

| チェック項目 | 判定基準 |
|-------------|---------|
| 文字数 | 1,300字以上、2,000字以下 |
| 必須セクション | 6パート全て含まれている |
| 案件関連性 | 案件キーワードが含まれている |
| 自然さ | 不自然な繰り返しがない |
| 具体性 | 具体的な提案内容が含まれている |

### 6.2. 再生成条件

以下の条件に該当する場合、再生成を試みる（最大3回）:

| 条件 | アクション |
|------|----------|
| 文字数が1,000字未満 | 再生成（より詳細にするよう指示） |
| 文字数が2,000字超過 | 再生成（簡潔にするよう指示） |
| 案件キーワード0件 | 再生成（案件内容に沿うよう指示） |

### 6.3. 禁止事項

生成時に以下を避けるようプロンプトで指示:

| 禁止事項 | 理由 |
|---------|------|
| 虚偽の実績 | 信頼性の毀損 |
| 過度な自慢 | 不快感を与える |
| 定型文の羅列 | 誠意が伝わらない |
| 競合批判 | プロフェッショナルでない |
| 価格のダンピング表現 | 価値を下げる |

---

## 7. データフロー

### 7.1. 入力データ

```python
@dataclass
class GenerationInput:
    """提案文生成の入力"""
    job_info: JobInfo           # 案件情報
    github_data: GitHubData | None  # GitHub情報（オプション）
    profile: ProfileConfig      # 固定文・プロフィール
    service: str               # "lancers" | "crowdworks"
```

### 7.2. 処理フロー

```
1. 入力データの検証
   ↓
2. カテゴリの判定
   ↓
3. 関連リポジトリの抽出（GitHub情報あれば）
   ↓
4. プロンプトの組み立て
   ↓
5. Gemini APIで生成
   ↓
6. 品質チェック
   ↓
7. 文字数調整
   ↓
8. 最終出力
```

### 7.3. 出力データ

```python
@dataclass
class GenerationOutput:
    """提案文生成の出力"""
    proposal: str              # 生成された提案文
    metadata: ProposalMetadata # メタデータ

@dataclass
class ProposalMetadata:
    """提案文のメタデータ"""
    character_count: int       # 文字数
    category: str             # 判定されたカテゴリ
    matched_skills: list[str]  # マッチしたスキル
    used_repos: list[str]     # 使用したリポジトリ名
    generation_time: float    # 生成時間（秒）
```

---

## 関連ドキュメント

- [プロンプト設計](../design/prompts.md)
- [スクレイピング仕様](./scraping.md)
- [GitHub連携仕様](./github.md)
- [設定仕様](./config.md)
